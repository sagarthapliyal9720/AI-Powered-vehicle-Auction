{% extends "Base.html" %}
{% block content %}

<div class="container py-5">

    <h2 class="text-center fw-bold mb-5">
        ðŸš— Active Car Auctions
    </h2>
    <!-- SEARCH & FILTER -->
<div class="card shadow-sm border-0 mb-4 p-3">
    <form method="GET">
        <div class="row g-3 align-items-center">

            <!-- Search -->
            <div class="col-md-4">
                <input type="text"
                       name="search"
                       class="form-control"
                       placeholder="Search by title or brand..."
                       value="{{ request.GET.search }}">
            </div>

            <!-- Vehicle Type -->
            <div class="col-md-3">
                <select name="type" class="form-select">
                    <option value="">All Vehicles</option>
                    <option value="2"
                        {% if request.GET.type == "2" %}selected{% endif %}>
                        2-Wheeler
                    </option>
                    <option value="4"
                        {% if request.GET.type == "4" %}selected{% endif %}>
                        4-Wheeler
                    </option>
                </select>
            </div>

            <!-- Sort -->
            <div class="col-md-3">
                <select name="sort" class="form-select">
                    <option value="">Sort by Price</option>
                    <option value="low"
                        {% if request.GET.sort == "low" %}selected{% endif %}>
                        Low to High
                    </option>
                    <option value="high"
                        {% if request.GET.sort == "high" %}selected{% endif %}>
                        High to Low
                    </option>
                </select>
            </div>

            <!-- Button -->
            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-dark">
                    Apply
                </button>
            </div>

        </div>
    </form>
</div>



    <div class="row g-4">
        {% for car in cars %}
        <div class="col-lg-4 col-md-6 col-sm-12">

            <div class="card h-100 border-0 shadow-lg auction-card">

                <!-- Car Image -->
                {% if car.image %}
                <img src="{{ car.image.url }}"
                     class="card-img-top rounded-top"
                     style="height:220px; object-fit:cover;">
                {% else %}
                <img src="https://via.placeholder.com/300x220"
                     class="card-img-top rounded-top">
                {% endif %}

                <div class="card-body d-flex flex-column p-4">

                    <!-- Title -->
                    <h5 class="card-title fw-bold mb-3">
                        {{ car.title }}
                    </h5>

                    <!-- Brand -->
                    <p class="text-muted mb-2">
                        <strong>Brand:</strong> {{ car.brand }}
                    </p>

                    <!-- Price Highlight -->
                    <div class="bg-light p-3 rounded mb-3">
                        <h6 class="text-secondary mb-1">Base Price</h6>
                        <h4 class="text-primary fw-bold mb-0">
                            â‚¹{{ car.base_price }}
                        </h4>
                    </div>

                    <!-- Auction End -->
                   <p class="mb-1">
    <strong>Auction Ends:</strong> {{ car.auction_end }}
</p>

<span class="fw-bold text-danger countdown-timer"
      data-end="{{ car.auction_end|date:'c' }}">
</span>


                    <!-- Button -->
                    <a href="{% url 'car_detail' car.id %}"
                       class="btn btn-dark w-100 fw-bold mt-auto">
                        View Details â†’
                    </a>

                </div>
            </div>

        </div>
        {% empty %}
        <div class="text-center">
            <div class="alert alert-info">
                No active auctions available.
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Optional Hover Effect -->
<style>
.auction-card {
    transition: all 0.3s ease;
}
.auction-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}
</style>
<script>
    function startCountdown() {
        const timers = document.querySelectorAll(".countdown-timer");

        timers.forEach(function(timer) {

            const auctionEnd = new Date(timer.dataset.end).getTime();

            const interval = setInterval(function () {

                const now = new Date().getTime();
                const distance = auctionEnd - now;

                if (distance <= 0) {
                    clearInterval(interval);
                    timer.innerHTML = "Auction Ended";
                    timer.classList.remove("text-danger");
                    timer.classList.add("text-success");
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) 
                              / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) 
                                / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                timer.innerHTML =
                    days + "d " +
                    hours + "h " +
                    minutes + "m " +
                    seconds + "s ";

            }, 1000);

        });
    }

    startCountdown();
</script>


{% endblock %}
